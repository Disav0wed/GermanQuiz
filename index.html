<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center h-screen">
    <div id="app" class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <!-- Admin Section -->
        <div id="admin-section" class="mb-6 hidden">
            <h2 class="text-2xl font-bold mb-4 text-center">Admin: Upload Questions</h2>
            <input type="file" id="question-file" accept=".json" class="mb-4 w-full">
            <button id="upload-btn" class="bg-blue-500 text-white px-4 py-2 rounded w-full hover:bg-blue-600">Upload</button>
        </div>

        <!-- User Section -->
        <div id="user-section">
            <h2 class="text-2xl font-bold mb-4 text-center">Quiz App</h2>
            <div id="quiz-setup" class="mb-4">
                <label for="num-questions" class="block mb-2">Number of Questions:</label>
                <input type="number" id="num-questions" min="1" value="5" class="w-full p-2 border rounded mb-4">
                <button id="start-quiz" class="bg-green-500 text-white px-4 py-2 rounded w-full hover:bg-green-600">Start Quiz</button>
            </div>
            <div id="quiz" class="hidden">
                <h3 id="question-text" class="text-lg font-semibold mb-4"></h3>
                <div id="options" class="space-y-2"></div>
                <div class="flex justify-between mt-4">
                    <button id="prev-btn" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed">Previous</button>
                    <button id="next-btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed">Next</button>
                </div>
            </div>
            <div id="result" class="hidden">
                <h3 class="text-xl font-bold mb-4 text-center">Quiz Completed!</h3>
                <p id="score-text" class="mb-4"></p>
                <button id="restart-btn" class="bg-green-500 text-white px-4 py-2 rounded w-full hover:bg-green-600">Restart Quiz</button>
            </div>
        </div>
    </div>

    <script>
        const questionFileInput = document.getElementById('question-file');
        const uploadBtn = document.getElementById('upload-btn');
        const numQuestionsInput = document.getElementById('num-questions');
        const startQuizBtn = document.getElementById('start-quiz');
        const questionText = document.getElementById('question-text');
        const optionsDiv = document.getElementById('options');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const quizSetup = document.getElementById('quiz-setup');
        const quizDiv = document.getElementById('quiz');
        const resultDiv = document.getElementById('result');
        const scoreText = document.getElementById('score-text');
        const restartBtn = document.getElementById('restart-btn');
        const adminSection = document.getElementById('admin-section');

        let questions = JSON.parse(localStorage.getItem('questions')) || [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = null;
        let answers = []; // Track user answers for navigation

        // Check if URL has ?admin to show admin section
        if (window.location.search.includes('admin')) {
            adminSection.classList.remove('hidden');
        }

        // Handle JSON upload
        uploadBtn.addEventListener('click', () => {
            const file = questionFileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const uploadedQuestions = JSON.parse(e.target.result);
                        questions = uploadedQuestions;
                        localStorage.setItem('questions', JSON.stringify(questions));
                        alert('Questions uploaded successfully!');
                    } catch (err) {
                        alert('Invalid JSON format.');
                    }
                };
                reader.readAsText(file);
            }
        });

        // Start quiz
        startQuizBtn.addEventListener('click', () => {
            const numQuestions = parseInt(numQuestionsInput.value);
            if (questions.length === 0) {
                alert('No questions available. Please upload questions first.');
                return;
            }
            if (numQuestions > questions.length) {
                alert(`Only ${questions.length} questions available.`);
                return;
            }
            currentQuestions = questions.sort(() => Math.random() - 0.5).slice(0, numQuestions);
            currentQuestionIndex = 0;
            score = 0;
            answers = new Array(numQuestions).fill(null); // Reset answers array
            quizSetup.classList.add('hidden');
            quizDiv.classList.remove('hidden');
            displayQuestion();
        });

        // Display current question
        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            questionText.textContent = `${currentQuestionIndex + 1}. ${question.question}`;
            optionsDiv.innerHTML = '';
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'w-full p-2 border rounded hover:bg-gray-100';
                btn.textContent = option;
                // Highlight if previously answered
                if (answers[currentQuestionIndex] === index) {
                    btn.classList.add(
                        index === question.correctAnswer ? 'bg-green-200' : 'bg-red-200'
                    );
                    btn.disabled = true;
                }
                btn.addEventListener('click', () => checkAnswer(index, btn));
                optionsDiv.appendChild(btn);
            });
            updateNavigationButtons();
        }

        // Check answer
        function checkAnswer(selectedIndex